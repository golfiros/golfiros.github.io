<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
  </head>
  <body>redirecting to texlive.net</body>
  <script type=module>
    document.body.onload = async () => {
      const params = new URLSearchParams(window.location.search);
      const path = `/tex/${params.get("p")}`;

      const manifest = await 
        fetch(`${path}/manifest.json`)
        .then((c) => c.text())
        .then(JSON.parse);

      const cc = document.body.appendChild(document.createElement("form"));
      cc.hidden = true;
      cc.method = "post";
      cc.action = "https://texlive.net/cgi-bin/latexcgi"
      cc.enctype = "multipart/form-data"

      for (const src of manifest.sources) {
        const content = cc.appendChild(document.createElement("textarea"));
        content.name = "filecontents[]";
        content.textContent = await
          fetch(`${path}/${src}`)
          .then((c) => c.text());

        const name = cc.appendChild(document.createElement("input"));
        name.type = "text";
        name.name = "filename[]";
        name.value = src;
      };

      const eng = cc.appendChild(document.createElement("input"));
      eng.type = "text";
      eng.name = "engine";
      eng.value = "lualatex";

      const ret = cc.appendChild(document.createElement("input"));
      ret.type = "text";
      ret.name = "return";
      ret.value = "pdf";

      console.log(cc);
      cc.submit();
    }
  </script>
</html>
