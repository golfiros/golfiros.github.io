<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
  </head>
  <body>redirecting to texlive.net</body>
  <script type=module>
    document.body.onload = async () => {
      const params = new URLSearchParams(window.location.search);
      const path = `/tex/${params.get("p")}`;

      const manifest = await 
        fetch(`${path}/manifest.json`)
        .then((c) => c.text())
        .then(JSON.parse);

      const cc = document.createElement("form");
      document.body.appendChild(cc);
      cc.hidden = true;
      cc.method = "post";
      cc.action = "https://texlive.net/cgi-bin/latexcgi"
      cc.enctype = "multipart/form-data"

      for (const src of manifest.sources) {
        const content = document.createElement("textarea");
        cc.appendChild(content);
        content.name = "filecontents[]";
        content.textContent = await
          fetch(`${path}/${src}`)
          .then((c) => c.text());

        const name = document.createElement("input");
        cc.appendChild(name);
        name.type = "text";
        name.name = "filename[]";
        name.value = src;
      };

      const eng = document.createElement("input");
      cc.appendChild(eng);
      eng.type = "text";
      eng.name = "engine";
      eng.value = "xelatex";

      const ret = document.createElement("input");
      cc.appendChild(ret);
      ret.type = "text";
      ret.name = "return";
      ret.value = "pdf";

      console.log(cc);
      cc.submit();
    }
  </script>
</html>
